# å°‘çº³è¨€ä¸­åŒ»çŸ¥è¯†å›¾è°± - éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°†é¡¹ç›®éƒ¨ç½²ä¸ºå¯è®¿é—®çš„ç½‘ç«™æˆ–APPã€‚

## ğŸ“‹ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### æ–¹å¼ä¸€ï¼šæœ¬åœ°éƒ¨ç½²ï¼ˆé€‚åˆæµ‹è¯•å’Œå°è§„æ¨¡ä½¿ç”¨ï¼‰
- åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå‰ç«¯å’Œåç«¯
- é€‚åˆä¸ªäººä½¿ç”¨æˆ–å†…ç½‘è®¿é—®

### æ–¹å¼äºŒï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆæ¨èï¼‰
- éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€AWSç­‰ï¼‰
- æ”¯æŒå…¬ç½‘è®¿é—®
- éœ€è¦åŸŸåå’ŒSSLè¯ä¹¦

### æ–¹å¼ä¸‰ï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDockerï¼‰
- ä½¿ç”¨Dockerå®¹å™¨åŒ–éƒ¨ç½²
- æ˜“äºç®¡ç†å’Œæ‰©å±•

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæœ¬åœ°ï¼‰

### 1. æ„å»ºå‰ç«¯

```bash
cd frontend
npm install
npm run build
```

æ„å»ºå®Œæˆåï¼Œå‰ç«¯æ–‡ä»¶ä¼šåœ¨ `frontend/dist` ç›®å½•ã€‚

### 2. é…ç½®åç«¯

åˆ›å»º `backend/.env` æ–‡ä»¶ï¼š

```env
NODE_ENV=production
PORT=3001
NEO4J_URI=neo4j+s://f36358f7.databases.neo4j.io
NEO4J_USER=neo4j
NEO4J_PASSWORD=æ‚¨çš„Neo4jå¯†ç 
FRONTEND_URL=http://localhost:3001
```

### 3. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

```bash
cd backend
node server-production.js
```

è®¿é—®ï¼šhttp://localhost:3001

## ğŸŒ äº‘æœåŠ¡å™¨éƒ¨ç½²

### å‡†å¤‡å·¥ä½œ

1. **è´­ä¹°äº‘æœåŠ¡å™¨**
   - æ¨èé…ç½®ï¼š2æ ¸4Gå†…å­˜ï¼Œ50Gç¡¬ç›˜
   - æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04 LTS æˆ– CentOS 7+

2. **å®‰è£…Node.js**
   ```bash
   # Ubuntu
   curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
   sudo apt-get install -y nodejs
   
   # CentOS
   curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
   sudo yum install -y nodejs
   ```

3. **å®‰è£…PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰**
   ```bash
   npm install -g pm2
   ```

### éƒ¨ç½²æ­¥éª¤

1. **ä¸Šä¼ é¡¹ç›®æ–‡ä»¶**
   ```bash
   # ä½¿ç”¨scpæˆ–FTPå·¥å…·ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨
   scp -r tcm-knowledge-graph user@your-server-ip:/opt/
   ```

2. **åœ¨æœåŠ¡å™¨ä¸Šæ„å»º**
   ```bash
   cd /opt/tcm-knowledge-graph/frontend
   npm install
   npm run build
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cd /opt/tcm-knowledge-graph/backend
   cp env.example .env
   # ç¼–è¾‘.envæ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„é…ç½®
   ```

4. **ä½¿ç”¨PM2å¯åŠ¨æœåŠ¡**
   ```bash
   cd /opt/tcm-knowledge-graph/backend
   pm2 start server-production.js --name tcm-api
   pm2 save
   pm2 startup  # è®¾ç½®å¼€æœºè‡ªå¯
   ```

5. **é…ç½®Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ä½†æ¨èï¼‰**
   
   å®‰è£…Nginxï¼š
   ```bash
   sudo apt-get install nginx  # Ubuntu
   sudo yum install nginx      # CentOS
   ```

   åˆ›å»ºNginxé…ç½® `/etc/nginx/sites-available/tcm-kg`ï¼š
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;  # æ›¿æ¢ä¸ºæ‚¨çš„åŸŸå
       
       # å‰ç«¯é™æ€æ–‡ä»¶
       location / {
           root /opt/tcm-knowledge-graph/frontend/dist;
           try_files $uri $uri/ /index.html;
       }
       
       # APIä»£ç†
       location /api {
           proxy_pass http://localhost:3001;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

   å¯ç”¨é…ç½®ï¼š
   ```bash
   sudo ln -s /etc/nginx/sites-available/tcm-kg /etc/nginx/sites-enabled/
   sudo nginx -t
   sudo systemctl restart nginx
   ```

6. **é…ç½®SSLè¯ä¹¦ï¼ˆHTTPSï¼‰**
   
   ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦ï¼š
   ```bash
   sudo apt-get install certbot python3-certbot-nginx
   sudo certbot --nginx -d your-domain.com
   ```

## ğŸ³ Dockeréƒ¨ç½²

### 1. åˆ›å»ºDockerfile

**backend/Dockerfile:**
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install --production

COPY . .

EXPOSE 3001

CMD ["node", "server-production.js"]
```

**frontend/Dockerfile:**
```dockerfile
FROM node:18-alpine as build

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
```

### 2. åˆ›å»ºdocker-compose.yml

```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=production
      - NEO4J_URI=${NEO4J_URI}
      - NEO4J_USER=${NEO4J_USER}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
    restart: unless-stopped

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
```

### 3. å¯åŠ¨

```bash
docker-compose up -d
```

## ğŸ“± ç§»åŠ¨ç«¯APPï¼ˆPWAï¼‰

é¡¹ç›®å·²æ”¯æŒPWAï¼Œå¯ä»¥å®‰è£…ä¸ºç§»åŠ¨APPï¼š

1. **æ·»åŠ PWAé…ç½®**
   - åˆ›å»º `frontend/public/manifest.json`
   - æ·»åŠ Service Worker

2. **è®¿é—®ç½‘ç«™**
   - åœ¨ç§»åŠ¨æµè§ˆå™¨ä¸­æ‰“å¼€ç½‘ç«™
   - é€‰æ‹©"æ·»åŠ åˆ°ä¸»å±å¹•"

## ğŸ”§ ç¯å¢ƒå˜é‡è¯´æ˜

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| NODE_ENV | è¿è¡Œç¯å¢ƒ | production |
| PORT | åç«¯ç«¯å£ | 3001 |
| NEO4J_URI | Neo4jè¿æ¥URI | - |
| NEO4J_USER | Neo4jç”¨æˆ·å | neo4j |
| NEO4J_PASSWORD | Neo4jå¯†ç  | - |
| FRONTEND_URL | å‰ç«¯URL | http://localhost:3001 |

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä½¿ç”¨HTTPS**
   - é…ç½®SSLè¯ä¹¦
   - å¼ºåˆ¶HTTPSé‡å®šå‘

2. **ç¯å¢ƒå˜é‡ä¿æŠ¤**
   - ä¸è¦å°†`.env`æ–‡ä»¶æäº¤åˆ°Git
   - ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡

3. **é˜²ç«å¢™é…ç½®**
   - åªå¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ80, 443, 22ï¼‰
   - é™åˆ¶APIè®¿é—®é¢‘ç‡

4. **æ•°æ®åº“å®‰å…¨**
   - ä½¿ç”¨å¼ºå¯†ç 
   - é™åˆ¶IPè®¿é—®ï¼ˆå¦‚æœå¯èƒ½ï¼‰

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### PM2ç›‘æ§

```bash
pm2 monit          # å®æ—¶ç›‘æ§
pm2 logs           # æŸ¥çœ‹æ—¥å¿—
pm2 restart tcm-api # é‡å¯æœåŠ¡
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs tcm-api

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

## ğŸ†˜ å¸¸è§é—®é¢˜

### 1. å‰ç«¯æ— æ³•è®¿é—®åç«¯API

**è§£å†³ï¼š**
- æ£€æŸ¥CORSé…ç½®
- ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. Neo4jè¿æ¥å¤±è´¥

**è§£å†³ï¼š**
- æ£€æŸ¥Neo4j URIå’Œå¯†ç 
- ç¡®è®¤ç½‘ç»œè¿æ¥
- æ£€æŸ¥Neo4jæœåŠ¡çŠ¶æ€

### 3. é™æ€èµ„æº404

**è§£å†³ï¼š**
- ç¡®è®¤å‰ç«¯å·²æ„å»º
- æ£€æŸ¥Nginxé…ç½®
- ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›®README.md
- å¿«é€Ÿå¼€å§‹.md
- é¡¹ç›®è¿›åº¦è®°å½•.md

