# 🚀 下一步：部署后端到Railway

前端已成功部署！现在需要部署后端，让网站完整运行。

---

## 📋 部署步骤概览

1. ✅ **已完成**：前端部署到Vercel
2. ⏭️ **下一步**：后端部署到Railway
3. ⏭️ **然后**：配置前后端连接
4. ⏭️ **最后**：测试完整功能

---

## 🔧 步骤1：在Railway部署后端

### 1.1 访问Railway并登录

1. **打开Railway**
   - 访问：https://railway.app
   - 点击右上角 "Login" 或 "Start a New Project"
   - 使用 **GitHub账号登录**（推荐，因为项目在GitHub上）

### 1.2 创建新项目

1. **点击 "New Project"**
   - 在Railway仪表板首页
   - 点击绿色的 "New Project" 按钮

2. **选择部署方式**
   - 选择 **"Deploy from GitHub repo"**
   - 会显示您的GitHub仓库列表

3. **选择仓库**
   - 搜索并选择：`tcm-knowledge-graph`
   - 点击仓库

### 1.3 配置服务

Railway会自动检测项目，但需要手动配置：

1. **设置Root Directory**
   - 在项目设置中，找到 "Root Directory"
   - 设置为：`backend`
   - 这样Railway知道从哪个目录启动服务

2. **设置Start Command（如果需要）**
   - 在 "Settings" → "Deploy" 中
   - Start Command：`node server-simple.js`
   - 或：`npm start`

### 1.4 添加环境变量

这是关键步骤！点击 "Variables" 标签，添加以下变量：

```env
NODE_ENV=production
PORT=3001
NEO4J_URI=neo4j+s://您的Neo4j地址.databases.neo4j.io
NEO4J_USER=neo4j
NEO4J_PASSWORD=您的Neo4j密码
FRONTEND_URL=https://您的前端地址.vercel.app
```

**重要提示：**
- `NEO4J_URI`：您的Neo4j Aura数据库地址
- `NEO4J_PASSWORD`：您的Neo4j密码
- `FRONTEND_URL`：从Vercel获取的前端地址

### 1.5 部署

1. **Railway会自动开始部署**
   - 等待部署完成（约3-5分钟）
   - 可以在 "Deployments" 标签查看进度

2. **获取后端地址**
   - 部署完成后，在 "Settings" → "Networking"
   - 会生成一个公共URL，类似：`https://xxx.up.railway.app`
   - **复制这个地址**，稍后需要用到

---

## 🔗 步骤2：连接前后端

### 2.1 更新前端环境变量

1. **回到Vercel**
   - 访问：https://vercel.com/dashboard
   - 进入 `tcm-knowledge-graph` 项目

2. **添加环境变量**
   - 点击 "Settings" → "Environment Variables"
   - 点击 "Add New"
   - 添加：
     ```
     Name: VITE_API_URL
     Value: https://您的后端地址.up.railway.app/api
     ```
   - 选择所有环境（Production, Preview, Development）
   - 点击 "Save"

3. **重新部署**
   - 点击 "Deployments" 标签
   - 找到最新的部署
   - 点击右侧的 "..." → "Redeploy"
   - 或Vercel会自动检测到环境变量更改并重新部署

### 2.2 更新后端环境变量

1. **回到Railway**
   - 进入您的后端项目
   - 点击 "Variables" 标签

2. **更新FRONTEND_URL**
   - 编辑 `FRONTEND_URL` 变量
   - 设置为您的Vercel前端地址：
     ```
     FRONTEND_URL=https://您的前端地址.vercel.app
     ```
   - 保存后Railway会自动重新部署

---

## ✅ 步骤3：测试网站

### 3.1 访问前端

1. **打开前端地址**
   - 访问您的Vercel前端URL
   - 检查页面是否正常加载

### 3.2 测试功能

1. **打开浏览器开发者工具**
   - 按 `F12` 键
   - 切换到 "Console" 标签

2. **测试搜索功能**
   - 尝试搜索一个中医术语
   - 查看是否有API请求
   - 检查是否有错误

3. **测试知识图谱**
   - 查看图谱是否正常显示
   - 检查节点和边的加载

### 3.3 检查API连接

1. **查看Network标签**
   - 在开发者工具中
   - 切换到 "Network" 标签
   - 刷新页面
   - 查看是否有 `/api/` 开头的请求
   - 检查请求状态（应该是200）

---

## 📝 需要准备的信息

在开始部署后端前，请准备好：

### 1. Neo4j连接信息
- **URI**: `neo4j+s://xxx.databases.neo4j.io`
- **用户名**: `neo4j`
- **密码**: （您的Neo4j Aura密码）

### 2. 前端地址
- 从Vercel获取的前端URL
- 格式：`https://xxx.vercel.app`

---

## 🎯 快速操作清单

### Railway部署后端：
- [ ] 访问 https://railway.app 并登录
- [ ] 创建新项目，选择GitHub仓库
- [ ] 设置Root Directory为 `backend`
- [ ] 添加环境变量（Neo4j信息）
- [ ] 等待部署完成
- [ ] 获取后端公共URL

### 连接配置：
- [ ] 在Vercel添加 `VITE_API_URL` 环境变量
- [ ] 在Railway更新 `FRONTEND_URL` 环境变量
- [ ] 重新部署前端和后端

### 测试验证：
- [ ] 访问前端URL
- [ ] 测试搜索功能
- [ ] 检查知识图谱显示
- [ ] 验证API连接正常

---

## ❓ 常见问题

### Q1: Railway找不到backend目录？
**解决：** 确保在Root Directory中设置为 `backend`

### Q2: 后端部署失败？
**解决：** 
- 检查环境变量是否都填写了
- 确认Neo4j连接信息正确
- 查看Railway的部署日志

### Q3: 前端无法连接后端？
**解决：**
- 检查 `VITE_API_URL` 是否正确
- 确认后端URL可以访问
- 检查CORS配置

### Q4: Neo4j连接失败？
**解决：**
- 确认URI格式正确（`neo4j+s://`）
- 检查密码是否正确
- 确认Neo4j Aura数据库正在运行

---

## 🎉 完成后

部署成功后，您将拥有：
- ✅ 公网可访问的前端网站（Vercel）
- ✅ 运行在云端的后端API（Railway）
- ✅ 完整的知识图谱系统
- ✅ 前后端正常连接

可以分享给其他人访问了！🚀

---

## 📞 需要帮助？

如果遇到问题：
1. 查看Railway的部署日志
2. 查看Vercel的构建日志
3. 检查浏览器控制台的错误信息
4. 告诉我具体的错误，我会帮您解决

现在开始部署后端吧！💪

