# 🔧 修复404错误 - API连接问题

从控制台错误可以看到，所有API请求都返回404，说明前端无法连接到后端。

---

## 🔍 问题分析

### 从代码可以看到：

前端API配置：
```typescript
const API_BASE_URL = import.meta.env.VITE_API_URL || 
  (import.meta.env.PROD ? '/api' : 'http://localhost:3001/api')
```

**问题：**
- 如果 `VITE_API_URL` 环境变量没有正确设置或未生效
- 前端会使用相对路径 `/api`
- 但Vercel上这些路径不存在，所以返回404

---

## ✅ 解决方案

### 方案1：确认Vercel环境变量已生效（最重要）

1. **检查环境变量**
   - 在Vercel项目 → Settings → Environment Variables
   - 确认 `VITE_API_URL` 存在
   - 确认值格式：`https://您的Railway后端URL/api`

2. **重新部署前端**
   - 环境变量更改后，**必须重新部署才能生效**
   - 在Vercel → Deployments
   - 找到最新部署，点击 "..." → "Redeploy"
   - 或等待自动重新部署

3. **确认部署完成**
   - 等待新部署完成（约2-3分钟）
   - 状态变为 "Ready"

---

### 方案2：检查Railway后端状态

1. **确认后端正在运行**
   - 在Railway → Deployments
   - 确认状态是 "Running"（绿色）

2. **获取后端URL**
   - Settings → Networking
   - 确认有公共域名
   - 复制URL

3. **测试后端API**
   - 在浏览器中直接访问：`https://您的Railway后端URL/api/stats`
   - 应该返回JSON数据
   - 如果也返回404，说明后端路由有问题

---

### 方案3：验证环境变量值

1. **在Vercel检查**
   - Settings → Environment Variables
   - 确认 `VITE_API_URL` 的值
   - 格式应该是：`https://xxx.up.railway.app/api`

2. **检查格式**
   - ✅ 正确：`https://tcm-knowledge-graph-production-xxx.up.railway.app/api`
   - ❌ 错误：`https://tcm-knowledge-graph-production-xxx.up.railway.app`（缺少 `/api`）
   - ❌ 错误：`http://...`（应该是 `https://`）

---

## 🎯 立即操作步骤

### 步骤1：检查Vercel环境变量

1. **进入Vercel项目设置**
   - Settings → Environment Variables

2. **确认VITE_API_URL存在**
   - 应该看到 `VITE_API_URL`
   - 值应该是您的Railway后端URL + `/api`

3. **如果不存在或错误**
   - 添加或编辑
   - 确保格式正确

---

### 步骤2：重新部署前端

1. **手动触发重新部署**
   - Deployments → 最新部署 → "..." → "Redeploy"
   - 或等待自动重新部署

2. **等待部署完成**
   - 约2-3分钟
   - 状态变为 "Ready"

---

### 步骤3：检查Railway后端

1. **确认后端运行**
   - Railway → Deployments
   - 状态应该是 "Running"

2. **获取后端URL**
   - Settings → Networking
   - 复制公共域名

3. **测试后端**
   - 在浏览器访问：`https://您的Railway后端URL/api/stats`
   - 应该返回数据，不是404

---

## 🔍 快速诊断

### 在浏览器控制台检查：

1. **查看Network请求**
   - 打开开发者工具 → Network
   - 尝试搜索
   - 查看API请求的URL

2. **检查请求URL**
   - 如果URL是：`https://tcm-knowledge-graph.vercel.app/api/stats`
     - 说明 `VITE_API_URL` 没有生效
     - 需要重新部署
   
   - 如果URL是：`https://xxx.up.railway.app/api/stats`
     - 说明环境变量已生效
     - 问题可能是后端未运行或路由错误

---

## 📋 检查清单

### Vercel配置：
- [ ] `VITE_API_URL` 环境变量已添加
- [ ] 值格式正确：`https://xxx.up.railway.app/api`
- [ ] 已重新部署前端
- [ ] 新部署已完成

### Railway配置：
- [ ] 后端服务正在运行
- [ ] 有公共域名
- [ ] 可以直接访问后端URL

### 测试：
- [ ] 后端URL可以访问：`https://xxx.up.railway.app/api/stats`
- [ ] 前端重新部署后，API请求URL正确

---

## 🎯 现在操作

1. **检查Vercel环境变量**
   - 确认 `VITE_API_URL` 存在且正确

2. **重新部署前端**
   - 手动触发Redeploy
   - 等待完成

3. **测试后端**
   - 直接访问Railway后端URL
   - 确认可以访问

4. **重新测试网站**
   - 访问前端网站
   - 查看是否还有404错误

---

告诉我：
1. Vercel的 `VITE_API_URL` 环境变量值是什么？
2. 是否已经重新部署？
3. Railway后端URL是什么？可以直接访问吗？

我会根据这些信息继续帮您解决问题！

