# 中医知识图谱系统 - 技术文档

版本：v1.0.0  
更新日期：2025-01-24  

---

## 1. 系统概述

中医知识图谱系统基于Neo4j图数据库构建，以React + Node.js为核心技术栈，实现中医病证分类标准的知识图谱展示、检索与分析。系统采用前后端分离架构，支持2D/3D可视化、智能搜索、图谱分析等功能。

---

## 2. 架构设计

### 2.1 总体架构

```
┌─────────────────────────────────────────────┐
│                   前端 (React)               │
│  - Vite + TypeScript                         │
│  - Ant Design + Tailwind CSS                 │
│  - Cytoscape / Three.js / ECharts            │
│  - REST API 调用                             │
└──────────────▲──────────────────────────────┘
               │HTTP/HTTPS (JSON)
┌──────────────┴──────────────────────────────┐
│                   后端 (Node.js)             │
│  - Express + TypeScript                      │
│  - 控制器 / 服务 / 路由 / 中间件              │
│  - Swagger API 文档                          │
│  - Redis 缓存 (可选)                          │
└──────────────▲──────────────────────────────┘
               │Neo4j Driver
┌──────────────┴──────────────────────────────┐
│                 数据层 (Neo4j)               │
│  - 节点：中医病证、证候、症状等               │
│  - 关系：包含、关联                          │
└─────────────────────────────────────────────┘
```

### 2.2 模块划分
- **前端应用**：`frontend/src`
  - `pages/`：页面模块（Dashboard、Explorer、Search、Analytics、Visualizations、NodeDetail）
  - `components/`：公共组件、图谱组件、可视化组件
  - `services/api.ts`：API封装
  - `stores/`：状态管理（Zustand）
  - `styles/`：全局样式与Tailwind配置
- **后端 API**：`backend/src`
  - `app.ts`：主入口，注册中间件、路由、Swagger
  - `routes/`：REST API定义（Graph、Search、Analytics等）
  - `controllers/`：业务控制器（待补充）
  - `services/`：业务逻辑与Neo4j访问（待补充）
  - `utils/`：通用工具、日志、错误处理

---

## 3. 前端设计

### 3.1 技术栈
- React 18 + TypeScript
- Vite 5 构建工具
- Ant Design + Tailwind CSS
- Cytoscape.js（2D图谱）、React Three Fiber + Three.js（3D）、ECharts（数据图表）
- React Router v6、Zustand

### 3.2 关键页面
- `Dashboard/index.tsx`：统计概览、快捷入口
- `Explorer/index.tsx`：交互式知识图谱
- `Search/index.tsx`：智能搜索
- `Analytics/index.tsx`：数据分析
- `Visualizations/index.tsx`：2D/3D可视化
- `Visualizations/components/Graph3D.tsx`：3D图谱实现
- `NodeDetail/index.tsx`：节点详情

### 3.3 状态与数据流
- 所有API请求封装在 `services/api.ts`
- 通过Zustand或局部状态管理前端数据
- 使用React Suspense + Lazy加载页面组件，提升性能

---

## 4. 后端设计

### 4.1 技术栈
- Node.js 18 + Express 4
- TypeScript
- Neo4j官方驱动
- Redis（可选，用于缓存）
- Helmet、CORS、compression、express-rate-limit（安全与性能）
- Swagger-jsdoc + swagger-ui-express（API文档）

### 4.2 app.ts主要内容
1. 加载环境变量（dotenv）
2. 注册安全/性能中间件（helmet、compression、morgan、rateLimit）
3. 注册JSON解析、CORS
4. 挂载业务路由：图谱、搜索、分析、用户等
5. 提供Swagger文档 `/api-docs`
6. 统一错误处理与404处理

### 4.3 Neo4j连接
- `server-simple.js` 与 `src/neo4j.js` 使用环境变量读取URI、User、Password
- 通过 `driver.verifyConnectivity()` 确保连接可用
- 每个请求在操作完成后关闭 session

### 4.4 REST API（示例）
- `GET /api/stats`：获取节点/关系统计
- `GET /api/nodes/roots`：获取根节点
- `GET /api/nodes/:code`：获取节点详情
- `GET /api/search?q=`：搜索节点
- `GET /api/analytics/overview`：分析概览
- 完整API可通过 `http://localhost:3001/api-docs` 查看

---

## 5. 数据模型

### 5.1 节点属性
- `code`：标准代码（主键）
+- `mainTerm`：术语名称
- `classificationLevel`：层级
- `category`：类别（病因、证候等）
- `synonyms`：同义词列表
- 其他扩展属性：描述、来源、备注等

### 5.2 关系类型
- `包含`：表示上下级分类
- `相关`：表示语义关联（可扩展）

### 5.3 示例 Cypher
```cypher
MATCH (n {code: $code})
OPTIONAL MATCH (n)-[:包含]->(child)
OPTIONAL MATCH (parent)-[:包含]->(n)
RETURN n, collect(child) as children, collect(parent) as parents
```

---

## 6. 部署与环境

### 6.1 开发环境
```bash
# 后端
cd backend
npm install
npm run dev

# 前端
cd frontend
npm install
npm run dev
```

### 6.2 生产部署
```bash
# 构建
cd frontend && npm run build
cd ../backend && npm run build

# 启动
npm start
```

### 6.3 必要环境变量
```
NEO4J_URI=neo4j+s://...
NEO4J_USER=neo4j
NEO4J_PASSWORD=******
REDIS_HOST=localhost
REDIS_PORT=6379
FRONTEND_URL=http://localhost:3000
```

---

## 7. 安全与日志
- 使用Helmet设置安全HTTP头
- Rate limit防止暴力请求
- JWT模块可用于后续认证扩展
- 使用Winston进行结构化日志记录（utils/logger.ts）

---

## 8. 测试与质量保证
- 前端：`npm run test`（集成Jest或Vitest）
- 后端：`npm run test`（Jest + ts-jest）
- ESLint + TypeScript 类型检查
- 推荐在CI中集成构建和测试流程

---

## 9. 未来扩展建议
1. 引入多语言支持（i18n）
2. 完善用户认证与权限系统
3. 增加批量导入/导出工具
4. 接入实时协作或注释功能
5. 优化大规模图谱的虚拟化性能

---

**维护人**：中医知识图谱项目组  
**联系方式**：参见README.md中的联系方式

